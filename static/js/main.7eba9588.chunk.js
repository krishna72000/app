(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{100:function(e,t){},124:function(e,t){},126:function(e,t){},134:function(e,t,n){},135:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(59),o=n.n(c),i=n(24),l=n(1),u=(n(69),n(3)),s=n(60),d=n.n(s);n(70);var m=function(){var e=Object(l.g)(),t=Object(a.useState)(""),n=Object(u.a)(t,2),c=n[0],o=n[1];return r.a.createElement("div",{className:"App"},r.a.createElement("img",{src:d.a,className:"App-logo",alt:"logo"}),r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.push(c)}},r.a.createElement("input",{className:"Room-id-input",placeholder:"Please enter room id",value:c,onChange:function(e){return o(e.target.value)}}),r.a.createElement("button",{className:"Join-room-button",type:"submit"},"Join")),r.a.createElement("button",{className:"Create-room-button",onClick:function(){var t=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);e.push(t)}},"Create room"))},b=n(63),f=n(62),h=n.n(f),p=n(34),E=n.n(p),g=n(16),v=n.n(g),j=n(8),O=function(e){var t=Object(a.useState)(!0),n=Object(u.a)(t,2),c=n[0],o=n[1];return r.a.createElement("div",{className:"User-video-container",style:c?{width:"72px",height:"72px",borderRadius:"36px"}:{height:"144px",borderRadius:"8px"}},r.a.createElement("video",{onClick:function(){return o(!c)},className:"Video",playsInline:!0,autoPlay:!0,muted:!0,ref:e.streamRef,style:e.camEnabled?c?{}:{width:"initial",objectFit:"contain"}:{display:"none"}}))},w=function(e){var t=Object(a.useRef)(),n=Object(a.useState)(!0),c=Object(u.a)(n,2),o=c[0],i=c[1],l=Object(a.useState)(!1),s=Object(u.a)(l,2),d=s[0],m=s[1],b=Object(a.useState)(!0),f=Object(u.a)(b,2),h=f[0],p=f[1];return Object(a.useEffect)((function(){e.peer.on("stream",(function(e){t.current.srcObject=e})),e.peer.on("data",(function(t){var n=JSON.parse(t);console.log(e.peerId+" state",n),m(n.camEnabled),p(n.micEnabled)}))}),[e.peer,e.peerId]),t.srcObject?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{className:"Peer-video-container",style:{width:e.width+"px",height:e.height+"px"}},r.a.createElement("video",{onClick:function(){return i(!o)},className:"Video",playsInline:!0,autoPlay:!0,ref:t,style:o?{}:{objectFit:"contain"}}),!d&&r.a.createElement("div",{className:"Peer-video-placeholder"},r.a.createElement(j.d,{className:"Peer-video-placeholder-icon"})),!h&&r.a.createElement(j.c,{className:"Peer-video-muted-icon"}))};n(134);var N=function(){var e=Object(l.g)(),t=Object(l.h)().roomId,n=Object(a.useState)([]),c=Object(u.a)(n,2),o=c[0],i=c[1],s=Object(a.useRef)([]),d=Object(a.useRef)(),m=Object(a.useRef)(),f=Object(a.useRef)(),p=Object(a.useState)({gridWidth:0,videoWidth:0,videoHeight:0}),g=Object(u.a)(p,2),N=g[0],I=N.gridWidth,S=N.videoWidth,k=N.videoHeight,R=g[1],x=Object(a.useState)(!0),y=Object(u.a)(x,2),C=y[0],M=y[1],W=Object(a.useRef)(!0),T=Object(a.useState)(!0),J=Object(u.a)(T,2),P=J[0],B=J[1],D=Object(a.useRef)(!0),H=Object(a.useState)(!1),F=Object(u.a)(H,2),U=F[0],A=F[1],L=Object(a.useState)(!1),V=Object(u.a)(L,2),z=V[0],q=V[1],G=Object(a.useState)(0),K=Object(u.a)(G,2),Q=K[0],X=K[1],Y=Object(a.useRef)(),Z=Object(a.useState)(null),$=Object(u.a)(Z,2),_=$[0],ee=$[1],te=Object(a.useState)(!0),ne=Object(u.a)(te,2),ae=ne[0],re=ne[1];function ce(){navigator.clipboard.writeText(window.location.href),ee("Room link has been copied to clipboard!"),setTimeout((function(){return ee(null)}),3e3)}function oe(){clearInterval(Y.current),d.current.close(),d.current.srcObject&&m.current.srcObject.getTracks().forEach((function(e){e.stop()})),s.current=[],i([]),q(!0),console.log("Disconnected from room")}function ie(){var e=Math.floor(Q/36e5),t=Math.floor((Q-36e5*e)/6e4),n=Math.floor((Q-36e5*e-6e4*t)/1e3),a="",r=t+":",c=n.toString();return e>0&&(a=e+":"),t<10&&(r="0"+t+":"),n<10&&(c="0"+n),a+r+c}function le(){for(var e=1===s.current.length?window.innerWidth/window.innerHeight:4/3,t=s.current.length,n=window.innerHeight,a=window.innerWidth,r={area:0,cols:0,rows:0,width:0,height:0},c=1;c<=t;c++){var o=Math.ceil(t/c),i=void 0,l=void 0;a/(c*e)<=n/o?(i=Math.floor(a/c),l=Math.floor(i/e)):(l=Math.floor(n/o),i=Math.floor(l*e));var u=i*l;u>r.area&&(r={area:u,width:i,height:l,rows:o,cols:c})}R({gridWidth:r.width*r.cols,videoWidth:r.width,videoHeight:r.height})}return Object(a.useEffect)((function(){return d.current=h.a.connect("/"),window.mediaDevices.getUserMedia({video:!0,audio:!0,constraints:{video:{width:{ideal:4096},height:{ideal:2160}}}}).then((function(e){m.current&&(m.current.srcObject=e),d.current.emit("joinRoom",t),d.current.on("otherUsersInRoom",(function(t){var n=[];t.forEach((function(t){var a=function(e,t,n){var a=new E.a({initiator:!0,trickle:!1,objectMode:!0,stream:n});return a.on("signal",(function(n){d.current.emit("signal",{userToSignal:e,userId:t,signal:n})})),a.on("connect",(function(){return a.send(JSON.stringify({camEnabled:D.current,micEnabled:W.current}))})),a}(t,d.current.id,e);s.current.push({peerId:t,peer:a}),n.push({peerId:t,peer:a})})),i(n),le(),console.log("Joined room with users",t)})),d.current.on("startTimer",(function(e){A(!0),f.current=e,Y.current=setInterval((function(){X((new Date).getTime()-f.current)}),1e3)})),d.current.on("userJoined",(function(t){var n=function(e,t,n){var a=new E.a({initiator:!1,trickle:!1,objectMode:!0,stream:n});return a.on("signal",(function(e){d.current.emit("signalBack",{signal:e,userId:t})})),a.on("connect",(function(){return a.send(JSON.stringify({camEnabled:D.current,micEnabled:W.current}))})),a.signal(e),a}(t.signal,t.userId,e),a={peerId:t.userId,peer:n};s.current.push(a),i(Object(b.a)(s.current)),le(),console.log("User joined the room",t.userId)})),d.current.on("signalReceived",(function(e){s.current.find((function(t){return t.peerId===e.id})).peer.signal(e.signal)})),d.current.on("userLeft",(function(e){var t=s.current.find((function(t){return t.peerId===e}));t&&t.peer.destroy();var n=s.current.filter((function(t){return t.peerId!==e}));s.current=n,i(n),le(),console.log("User left the room",e),0===s.current.length&&oe()}))}),(function(e){v.a.load((function(){v.a.hasWebcam&&v.a.isWebsiteHasWebcamPermissions&&v.a.hasMicrophone&&v.a.isWebsiteHasMicrophonePermissions||re(!1)}))})),window.addEventListener("resize",le),function(){window.removeEventListener("resize",le)}}),[t]),r.a.createElement("div",{className:"Room"},ae&&r.a.createElement(r.a.Fragment,null,!z&&r.a.createElement(r.a.Fragment,null,!U&&r.a.createElement("div",null,r.a.createElement("div",{className:"Waiting-text"},"Waiting for peers..."),r.a.createElement("button",{onClick:ce,className:"Invite-button"},"Invite people")),U&&r.a.createElement("div",{className:"Grid",style:{maxWidth:I+"px"}},o.map((function(e){return r.a.createElement(w,{key:e.peerId,peer:e.peer,peerId:e.peerId,width:S,height:k})}))),r.a.createElement(O,{streamRef:m,camEnabled:P}),r.a.createElement("div",{className:"Call-time"},ie()),r.a.createElement("div",{className:"Buttons-container"},r.a.createElement("button",{onClick:ce,className:"Button"},r.a.createElement(j.e,null)),r.a.createElement("button",{className:"Button",onClick:function(){s.current.forEach((function(e){e.peer.send(JSON.stringify({camEnabled:!P,micEnabled:C}))})),m.current.srcObject.getVideoTracks()[0].enabled=!m.current.srcObject.getVideoTracks()[0].enabled,D.current=!D.current,B(D.current)}},P?r.a.createElement(j.f,null):r.a.createElement(j.g,null)),r.a.createElement("button",{className:"Button",onClick:function(){s.current.forEach((function(e){e.peer.send(JSON.stringify({camEnabled:P,micEnabled:!C}))})),m.current.srcObject.getAudioTracks()[0].enabled=!m.current.srcObject.getAudioTracks()[0].enabled,W.current=!W.current,M(W.current)}},C?r.a.createElement(j.b,null):r.a.createElement(j.c,null)),r.a.createElement("button",{className:"Button Endcall-button",onClick:oe},r.a.createElement(j.a,null))),_&&r.a.createElement("div",{className:"Toast"},_),r.a.createElement(l.a,{when:!0,message:function(){return oe()}})),z&&r.a.createElement("div",null,r.a.createElement("div",{className:"Call-ended-text"},"The call has ended"),r.a.createElement("div",{className:"Call-time-text"},"Duration: ",ie()),r.a.createElement("br",null),r.a.createElement("button",{className:"Reconnect-button",onClick:function(){return window.location.reload()}},"Reconnect to call"),r.a.createElement("br",null),r.a.createElement("button",{className:"Home-button",onClick:function(){return e.push("/")}},"Back to home"))),!ae&&r.a.createElement("div",null,r.a.createElement("div",{className:"Device-error-text"},"Device error"),r.a.createElement("div",{className:"Device-error-description-text"},"Please connect a mic and a webcam, grant the required permissions, then reload the page"),r.a.createElement("br",null),r.a.createElement("button",{className:"Reload-button",onClick:function(){return window.location.reload()}},"Reload page")))};o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.a,null,r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/",component:m}),r.a.createElement(l.b,{path:"/:roomId",component:N})))),document.getElementById("root"))},60:function(e,t,n){e.exports=n.p+"static/media/Logo.5d5d9eef.svg"},64:function(e,t,n){e.exports=n(135)},69:function(e,t,n){},70:function(e,t,n){}},[[64,1,2]]]);
//# sourceMappingURL=main.7eba9588.chunk.js.map